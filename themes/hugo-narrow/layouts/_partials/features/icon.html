{{/*
  Icon partial template

  Usage:
  {{ partial "features/icon.html" (dict "name" "sun" "class" "h-5 w-5" "id" "sun-icon") }}
  {{ partial "features/icon.html" (dict "name" "heart" "size" "lg") }}

  Parameters:
  - name: Icon name (required) - corresponds to SVG file in assets/icons/
  - class: CSS classes to apply to the SVG (optional)
  - id: HTML id attribute (optional)
  - size: Predefined size (optional) - "xs", "sm", "md", "lg", "xl", "2xl"
  - ariaLabel: Accessibility label (optional)
  - hidden: Whether to add aria-hidden="true" (optional, defaults to false)

  How it works:
  - Preserves original SVG attributes (viewBox, fill, stroke, etc.)
  - Removes width/height attributes to allow CSS control
  - Adds class, id, and aria attributes to the original SVG
  - Works with both filled and stroke icons automatically
*/}}

{{- $name := .name -}}
{{- $class := .class | default "" -}}
{{- $id := .id | default "" -}}
{{- $size := .size | default "" -}}
{{- $ariaLabel := .ariaLabel | default "" -}}
{{- $hidden := .hidden | default false -}}

{{/* Size presets */}}
{{- $sizeClasses := dict
  "xs" "h-3 w-3"
  "sm" "h-4 w-4"
  "md" "h-5 w-5"
  "lg" "h-6 w-6"
  "xl" "h-8 w-8"
  "2xl" "h-10 w-10"
-}}

{{/* Build CSS classes */}}
{{- $finalClass := $class -}}
{{- if $size -}}
  {{- $sizeClass := index $sizeClasses $size -}}
  {{- if $sizeClass -}}
    {{- $finalClass = printf "%s %s" $sizeClass $class -}}
  {{- end -}}
{{- end -}}

{{/* Get the SVG file */}}
{{- $iconPath := printf "icons/%s.svg" $name -}}
{{- $icon := resources.Get $iconPath -}}

{{- if $icon -}}
  {{- $content := $icon.Content -}}

  {{/* Remove width/height attributes that conflict with CSS */}}
  {{- $content = replaceRE `\s+width="[^"]*"` "" $content -}}
  {{- $content = replaceRE `\s+height="[^"]*"` "" $content -}}

  {{/* Build attributes to add to SVG tag */}}
  {{- $attrs := "" -}}
  {{- if $finalClass -}}
    {{- $attrs = printf ` class="%s"` ($finalClass | strings.TrimSpace) -}}
  {{- end -}}
  {{- if $id -}}
    {{- $attrs = printf `%s id="%s"` $attrs $id -}}
  {{- end -}}
  {{- if $ariaLabel -}}
    {{- $attrs = printf `%s aria-label="%s"` $attrs $ariaLabel -}}
  {{- end -}}
  {{- if $hidden -}}
    {{- $attrs = printf `%s aria-hidden="true"` $attrs -}}
  {{- end -}}

  {{/* Insert attributes into the opening SVG tag - match only the first occurrence */}}
  {{- $content = replaceRE `^(\s*)<svg` (printf `$1<svg%s` $attrs) $content 1 -}}

  {{- $content | safeHTML -}}
{{- else -}}
  {{/* Fallback if icon not found */}}
  <svg
    {{- if $id }} id="{{ $id }}"{{ end }}
    {{- if $finalClass }} class="{{ $finalClass | strings.TrimSpace }}"{{ end }}
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    {{- if $ariaLabel }} aria-label="{{ $ariaLabel }}"{{ end }}
    {{- if $hidden }} aria-hidden="true"{{ end }}>
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
  {{/* Log warning in development */}}
  {{- if hugo.IsDevelopment -}}
    {{- warnf "Icon '%s' not found at %s" $name $iconPath -}}
  {{- end -}}
{{- end -}}
