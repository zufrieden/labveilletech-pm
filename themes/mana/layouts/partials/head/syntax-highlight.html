{{- $darkTheme := default "catppuccin-macchiato" .Site.Params.codeHighlight.darkTheme -}}
{{- $lightTheme := default "catppuccin-frappe" .Site.Params.codeHighlight.lightTheme -}}

{{- $syntaxDark := resources.Get "css/syntax-dark.css" -}}
{{- $syntaxLight := resources.Get "css/syntax-light.css" -}}

{{- if $syntaxDark -}}
  {{- $syntaxDarkMin := $syntaxDark | minify | fingerprint -}}
  <link
    rel="stylesheet"
    href="{{ $syntaxDarkMin.RelPermalink }}"
    integrity="{{ $syntaxDarkMin.Data.Integrity }}"
    id="syntax-dark-theme"
    class="syntax-theme">
{{- end -}}

{{- if $syntaxLight -}}
  {{- $syntaxLightMin := $syntaxLight | minify | fingerprint -}}
  <link
    rel="stylesheet"
    href="{{ $syntaxLightMin.RelPermalink }}"
    integrity="{{ $syntaxLightMin.Data.Integrity }}"
    id="syntax-light-theme"
    class="syntax-theme"
    disabled>
{{- end -}}


<script>
  // Set initial syntax highlighting theme based on current theme
  (function () {
    const storedTheme = localStorage.getItem("theme");
    const systemPrefersLight = window.matchMedia("(prefers-color-scheme: light)").matches;
    const theme = storedTheme || (systemPrefersLight ? "light" : "dark");

    const syntaxDark = document.getElementById("syntax-dark-theme");
    const syntaxLight = document.getElementById("syntax-light-theme");

    if (theme === "light") {
      if (syntaxDark) syntaxDark.disabled = true;
      if (syntaxLight) syntaxLight.disabled = false;
    } else {
      if (syntaxDark) syntaxDark.disabled = false;
      if (syntaxLight) syntaxLight.disabled = true;
    }

    // Listen for theme changes
    const observer = new MutationObserver(() => {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      if (currentTheme === "light") {
        if (syntaxDark) syntaxDark.disabled = true;
        if (syntaxLight) syntaxLight.disabled = false;
      } else {
        if (syntaxDark) syntaxDark.disabled = false;
        if (syntaxLight) syntaxLight.disabled = true;
      }
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["data-theme"],
    });
  })();
</script>
